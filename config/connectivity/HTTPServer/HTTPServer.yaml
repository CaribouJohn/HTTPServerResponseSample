
connectivityPlugins:
  httpServer:
    libraryName: connectivity-http-server
    class: HTTPServer
  mapperCodec:
    libraryName: MapperCodec
    class: MapperCodec
  stringCodec:
    libraryName: connectivity-string-codec
    class: StringCodec
  diag:
    libraryName: DiagnosticCodec
    class: DiagnosticCodec

dynamicChainManagers:
  httpServerManager:
    transport: httpServer
    managerConfig:
      port: ${HTTPServer_port}
      staticFiles:
             /swagger.json:
                 file: ${PARENT_DIR}/swagger_HTTPServer.json
                 contentType: application/json
                 charset: UTF-8

dynamicChains:
  httpServer:
    - apama.eventMap:
        defaultEventType: RequestUpdate
        defaultChannel: requests
    - mapperCodec:
        "*":
          towardsHost:
            mapFrom:
              - payload.payload: payload
              - payload.requestId: metadata.requestId
            defaultValue:
              - payload.channel: "@{httpServer.responseChannel}"
          towardsTransport:
              mapFrom:
                - metadata.http.cookies: payload.cookies
                - metadata.http.headers: payload.headers
                - metadata.contentType: payload.contentType
                - metadata.charset: payload.charset
                - metadata.requestId: payload.requestId
                - payload: payload.payload
              defaultValue:
                - metadata.http.statusCode: 200

    - diag: { tag: serverside }
    - stringCodec
    - httpServer:
        automaticResponses: false
        responseTimeoutMs: 5000
        allowedMethods: [put]
